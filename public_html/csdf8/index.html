<?PHP
include("../buildpage.php");
//Static content
$header = "<html>".getHeader("CSDF8 Comparison")."<body>".getSideBar()."<div id='content-column'>
<h1>CSDF8 Tool</h1>";
$footer = "</div></body></html>";

if(!isset($_GET['toget']) || !is_numeric($_GET['toget']))
{
	echo $header;
	echo "<p>This tool very hackily compares a file version on enwiki along side the same file on commons, this allows admins to easily spot identical files with the correct permissions on both sites to be deleted from enwiki</p>";
	echo "<form action='index.html' method='get'>
	Number of files to compare: <input type='text' name='toget'>
	<input type='submit'>
	</form>";
	echo "<p>Files are taken from Category:Wikipedia_files_with_the_same_name_on_Wikimedia_Commons</p>";
	echo $footer;
}
else
{

	$header = $header."<ul>";
	$footer = "</ul>".$footer;
	echo $header;

	include '../../../classes/botclasses.php';
	include '../../../classes/wikitexttohtml.php';

	$wiki = new wikipedia;
	$wiki->url = 'http://en.wikipedia.org/w/api.php';
	global $wiki;

	$comm = new wikipedia;
	$comm->url = 'http://commons.wikimedia.org/w/api.php';
	global $comm;

	$cat = 'Category:Wikipedia_files_with_the_same_name_on_Wikimedia_Commons';
	//$cat = 'Category:Wikipedia files with the same name on Wikimedia Commons as of 27 December 2012';
	$files = $wiki->categorymembers($cat,true);
	$counter = 0;

	//Content creation
	foreach ($files as $file)
	{
		if($counter <$_GET['toget'] && strstr($file,"Category:") == false)
		{
			$counter++;
			$wi = $wiki->getfilelocation($file);
			$ci = $comm->getfilelocation($file);
			$wu = $wiki->getfileuploader($file);
			$cu = $comm->getfileuploader($file);
			//$ws= getimagesize($wi);
			//$cs= getimagesize($ci);
			$wimg = "<img align='left' src='$wi' alt='$file' height='100' width='100'>";
			$cimg = "<img align='left' src='$ci' alt='$file' height='100' width='100'>";
			$wp = $wiki->getpage($file);
			$cp = $comm->getpage($file);
			$wpe = preg_replace("/(\{\{cc|PD|GFDL|self|Non|public domain)/i","<b>$0</b>",$wp);
			$cpe = preg_replace("/(\{\{cc|PD|GFDL|self|Non|$wu|public domain|User:)/i","<b>$0</b>",$cp);
			
			echo "<li><a target='_blank' href='http://en.wikipedia.org/w/index.php?title=$file&action=delete&wpReason=CSDF8'><b>Delete</b></a>";
			echo "<table border='0' width='100%'><col width='50%'><col width='50%'>";
			echo "<tr><td>$wimg <a target='_blank' href='http://en.wikipedia.org/wiki/$file'>Wikipedia:$file </a> by <b>$wu</b></td><td>$cimg <a target='_blank' href='$ci'>Commons:$file </a> by $cu</td></tr>";
			echo "<tr><td>$wpe</td><td>$cpe</td></tr>";
			//echo "<tr><td>$wpe</td><td>$cpe</td><td></td></tr>";
			echo "</table>";
		}
	} 

	print $footer;
}
?>