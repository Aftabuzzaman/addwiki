<?php include(__DIR__."/../buildpage.php");?>
<html>
	<head>
	<?php echo getHead("Tools Lab");?>
	<script src="http://www.stathat.com/javascripts/embed.js"></script>
	<meta http-equiv="refresh" content="60">
	</head>
	<body>
	<?php echo getSideBar();?>
	<div id="content-column">

    <h1>Tools Labs</h1>
    
	<fieldset>
	<legend>Grid Info</legend>
	<? echo shell_exec('qstat -j'); ?>
    </fieldset>
	
	<fieldset>
	<legend>Job graphs</legend>
	<table border="0" cellspacing='0'>
	<tr>
	<th><script>StatHatEmbed.render({s1: '4WEeY', w: 375, h: 200, tf: 'hour_compare', title: 'ToolLab Jobs (hour)'});</script></th>
	<th><script>StatHatEmbed.render({s1: '4WEeY', w: 375, h: 200, tf: 'day_compare', title: 'ToolLab Jobs (day)'});</script></th>
	<th><script>StatHatEmbed.render({s1: '4WEeY', w: 375, h: 200, tf: 'week_compare', title: 'ToolLab Jobs (week)'});</script></th>
	</tr>
	</table>
	</fieldset>
    <fieldset>
	<legend>Hosts</legend>
	<table border="0" cellspacing='10'>
	<tr>
	<th>Host</th>
	<th>Load</th>
	<th>Tasks</th>
	<th>Mem</th>
	</tr>
	<?
	preg_match_all('/(tools-[^\.]+).pmtpa.wmflabs +([^ ]+) +([^ ]+) +([^ ]+) +([^ ]+) +([^ ]+) +([^ ]+) +([^\n]+)/',shell_exec('qhost'),$hosts);
	foreach($hosts[0] as $key => $host)
	{
		echo "<tr>";
		echo "<td>".$hosts[1][$key]."</td>";
		echo "<td>".$hosts[4][$key]."</td>";
		echo "<td>".exec("qstat -u '*' |grep -c ".$hosts[1][$key])."</td>";
		echo "<td>".$hosts[6][$key]." / ".$hosts[5][$key]."</td>";
		echo "</tr>";
	}
	?>
	</table></br>
	</fieldset>
	
	</div>
	</body>
</html>

